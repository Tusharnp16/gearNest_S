<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
    <meta charset="UTF-8">
    <title>Book Service - GearNest</title>
    <link rel="stylesheet" th:href="@{/css/style.css}" />
    <link rel="stylesheet" th:href="@{/css/bookservice.css}">
    <link rel="shortcut icon" th:href="@{/images/logo.png}" type="image/x-icon">

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>

    <header th:replace="~{fragments/header::header}"></header>
    <main>
        <section class="page-section">
            <div class="container">
                <div class="section-title">
                    <h1>Book a Service</h1>
                    <p>Complete the details below to schedule your service with Surat Premium Motors.</p>
                </div>

                <div class="booking-wrapper">
                    <div class="booking-details scroll-animate">
                        <h2>Booking Details</h2>
                        <form id="booking-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="vehicle-make">Vehicle Make</label>
                                    <input type="text" id="vehicle-make" name="vehicle-make"
                                        placeholder="e.g., Maruti Suzuki" value="Maruti Suzuki">
                                </div>
                                <div class="form-group">
                                    <label for="vehicle-model">Vehicle Model</label>
                                    <input type="text" id="vehicle-model" name="vehicle-model" placeholder="e.g., Swift"
                                        value="Swift">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="vehicle-number">Vehicle Number</label>
                                    <input type="text" id="vehicle-number" name="vehicle-number"
                                        placeholder="e.g., GJ05 AB 1234" value="GJ05 AB 1234">
                                </div>
                                <div class="form-group">
                                    <label for="vehicle-type">Vehicle Type</label>
                                    <select id="vehicle-type" name="vehicle-type">
                                        <option value="Car">Car</option>
                                        <option value="Bike">Bike</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="address">Pickup Address</label>
                                <input type="text" id="address" name="address" value="123 Auto Street">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="state">State</label>
                                    <select id="state"></select>
                                </div>
                                <div class="form-group">
                                    <label for="city">City</label>
                                    <select id="city"></select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="service-search-input">Select Service(s)</label>
                                <input type="text" id="service-search-input" placeholder="Search for a service...">
                                <div id="service-options-container" class="service-options-container">
                                    <!-- Service checkboxes will be dynamically inserted here -->
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="service-date">Select Date</label>
                                    <input type="date" id="service-date" name="service-date">
                                </div>
                                <div class="form-group">
                                    <label>Select Time Slot</label>
                                    <div class="time-slots">
                                        <div class="time-slot"><input type="radio" id="morning" name="time-slot"
                                                value="Morning" checked><label for="morning">Morning</label></div>
                                        <div class="time-slot"><input type="radio" id="afternoon" name="time-slot"
                                                value="Afternoon"><label for="afternoon">Afternoon</label></div>
                                        <div class="time-slot"><input type="radio" id="evening" name="time-slot"
                                                value="Evening"><label for="evening">Evening</label></div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <aside class="order-summary scroll-animate" style="transition-delay: 0.1s;">
                        <h2>Order Summary</h2>
                        <div class="summary-item">
                            <span class="label">Garage:</span>
                            <span class="value">Surat Premium Motors</span>
                        </div>
                        <div class="summary-item">
                            <span class="label">Vehicle Type:</span>
                            <span class="value" id="summary-vehicle-type">Car</span>
                        </div>
                        <div class="summary-item">
                            <span class="label">Vehicle:</span>
                            <span class="value" id="summary-vehicle"></span>
                        </div>
                        <div class="summary-item">
                            <span class="label">Service(s):</span>
                            <div class="value">
                                <ul id="summary-service-list"></ul>
                            </div>
                        </div>
                        <hr style="border: none; border-top: 1px dashed var(--color-gray-200); margin: 1.5rem 0;">
                        <div class="summary-item">
                            <span class="label">Service Cost:</span>
                            <span class="value" id="summary-cost">₹0.00</span>
                        </div>
                        <div class="summary-item">
                            <span class="label">Taxes (5%):</span>
                            <span class="value" id="summary-taxes">₹0.00</span>
                        </div>
                        <div class="summary-item">
                            <span class="label">Convenience Fee:</span>
                            <span class="value">₹50.00</span>
                        </div>
                        <div class="summary-item summary-total">
                            <span class="label">Total Amount:</span>
                            <span class="value" id="summary-total">₹50.00</span>
                        </div>
                        <button type="submit" form="booking-form" class="btn btn-primary"
                            style="width: 100%; margin-top: 2rem;">Proceed to Payment</button>
                    </aside>
                </div>
            </div>
        </section>
    </main>
    <footer th:replace="~{fragments/footer::footer}"></footer>
    <script th:src="@{/javascript/script.js}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) { entry.target.classList.add('is-visible'); }
                });
            }, { threshold: 0.1 });
            document.querySelectorAll('.scroll-animate').forEach(el => observer.observe(el));

            // Set min date for date picker to today
            const dateInput = document.getElementById('service-date');
            if (dateInput) {
                const today = new Date().toISOString().split('T')[0];
                dateInput.setAttribute('min', today);
            }

            // --- Booking Form Logic ---
            const vehicleMakeInput = document.getElementById('vehicle-make');
            const vehicleModelInput = document.getElementById('vehicle-model');
            const vehicleNumberInput = document.getElementById('vehicle-number');
            const vehicleTypeSelect = document.getElementById('vehicle-type');
            const serviceSearchInput = document.getElementById('service-search-input');
            const serviceOptionsContainer = document.getElementById('service-options-container');
            const stateSelect = document.getElementById('state');
            const citySelect = document.getElementById('city');

            const summaryVehicle = document.getElementById('summary-vehicle');
            const summaryVehicleType = document.getElementById('summary-vehicle-type');
            const summaryServiceList = document.getElementById('summary-service-list');
            const summaryCost = document.getElementById('summary-cost');
            const summaryTaxes = document.getElementById('summary-taxes');
            const summaryTotal = document.getElementById('summary-total');

            const services = [
                { name: "General Service", price: 1499 },
                { name: "Car Wash", price: 250 },
                { name: "Tyre Alignment", price: 799 },
                { name: "AC Repair", price: 1200 },
                { name: "Denting & Painting", price: 4500 }
            ];

            const locationData = {
                "Gujarat": ["Surat", "Ahmedabad", "Vadodara", "Rajkot"],
                "Maharashtra": ["Mumbai", "Pune", "Nagpur", "Nashik"],
                "Rajasthan": ["Jaipur", "Jodhpur", "Udaipur", "Kota"],
                "Karnataka": ["Bengaluru", "Mysuru", "Mangaluru", "Hubballi"]
            };

            // Populate states
            Object.keys(locationData).forEach(state => {
                stateSelect.add(new Option(state, state));
            });

            // Function to update cities based on selected state
            const updateCities = () => {
                const selectedState = stateSelect.value;
                citySelect.innerHTML = ''; // Clear existing options

                if (selectedState && locationData[selectedState]) {
                    locationData[selectedState].forEach(city => {
                        citySelect.add(new Option(city, city));
                    });
                }
            };

            // Set default values and populate cities
            stateSelect.value = "Gujarat";
            updateCities();
            citySelect.value = "Surat";

            // Populate services
            services.forEach(service => {
                const serviceHTML = `
                    <label class="service-option">
                        <input type="checkbox" name="service-type" value="${service.name}" data-price="${service.price}">
                        <div class="service-info">
                            <span class="service-name">${service.name}</span>
                        </div>
                        <span class="service-price">₹${service.price.toFixed(2)}</span>
                    </label>
                `;
                serviceOptionsContainer.insertAdjacentHTML('beforeend', serviceHTML);
            });

            const serviceCheckboxes = document.querySelectorAll('input[name="service-type"]');
            const serviceOptions = document.querySelectorAll('.service-option');

            function updateSummary() {
                // Update vehicle details
                const make = vehicleMakeInput.value.trim();
                const model = vehicleModelInput.value.trim();
                const number = vehicleNumberInput.value.trim();

                if (make || model || number) {
                    summaryVehicle.textContent = `${make} ${model} (${number})`;
                } else {
                    summaryVehicle.textContent = 'N/A';
                }

                // Update vehicle type
                summaryVehicleType.textContent = vehicleTypeSelect.value;

                // Update service and costs
                let totalServicePrice = 0;
                summaryServiceList.innerHTML = '';

                serviceCheckboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        const price = parseFloat(checkbox.dataset.price);
                        totalServicePrice += price;
                        const listItem = document.createElement('li');
                        listItem.innerHTML = `<span>${checkbox.value}</span><span>₹${price.toFixed(2)}</span>`;
                        summaryServiceList.appendChild(listItem);
                    }
                });

                if (summaryServiceList.children.length === 0) {
                    summaryServiceList.innerHTML = '<li><span>None</span><span>₹0.00</span></li>';
                }

                const convenienceFee = 50.00;
                const taxRate = 0.05;

                const taxes = totalServicePrice * taxRate;
                const total = totalServicePrice + taxes + convenienceFee;

                summaryCost.textContent = `₹${totalServicePrice.toFixed(2)}`;
                summaryTaxes.textContent = `₹${taxes.toFixed(2)}`;
                summaryTotal.textContent = `₹${total.toFixed(2)}`;
            }

            function filterServices() {
                const searchTerm = serviceSearchInput.value.toLowerCase();
                serviceOptions.forEach(option => {
                    const serviceName = option.querySelector('.service-name').textContent.toLowerCase();
                    if (serviceName.includes(searchTerm)) {
                        option.style.display = 'flex';
                    } else {
                        option.style.display = 'none';
                    }
                });
            }

            // --- Event Listeners ---
            vehicleMakeInput.addEventListener('keyup', updateSummary);
            vehicleModelInput.addEventListener('keyup', updateSummary);
            vehicleNumberInput.addEventListener('keyup', updateSummary);
            vehicleTypeSelect.addEventListener('change', updateSummary);
            serviceCheckboxes.forEach(checkbox => checkbox.addEventListener('change', updateSummary));
            serviceSearchInput.addEventListener('keyup', filterServices);
            stateSelect.addEventListener('change', updateCities);

            // Initial call to set default summary
            updateSummary();
        });
    </script>
</body>

</html>